# ãƒã‚±ãƒƒãƒˆ P1-006: Swaggeræ–‡æ›¸åŒ–

## ğŸ“‹ æ¦‚è¦
OpenAPI 3.0ä»•æ§˜ã«åŸºã¥ã„ã¦APIãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’ä½œæˆã—ã€Swagger UIã§é–²è¦§å¯èƒ½ã«ã™ã‚‹ã€‚

## ğŸ¯ ç›®æ¨™
- OpenAPIä»•æ§˜æ›¸ã®ä½œæˆ
- Swagger UIã®çµ±åˆ
- APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã®æ–‡æ›¸åŒ–
- ãƒªã‚¯ã‚¨ã‚¹ãƒˆ/ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚µãƒ³ãƒ—ãƒ«ã®è¿½åŠ 
- èªè¨¼ä»•æ§˜ã®æ–‡æ›¸åŒ–

## ğŸ“ è©³ç´°èª¬æ˜

### 1. å¿…è¦ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

```bash
npm install swagger-jsdoc swagger-ui-express
npm install -D @types/swagger-jsdoc @types/swagger-ui-express
```

### 2. Swaggerè¨­å®š

**src/config/swagger.ts:**
```typescript
import swaggerJsdoc from 'swagger-jsdoc';

const options: swaggerJsdoc.Options = {
  definition: {
    openapi: '3.0.0',
    info: {
      title: 'Circle-Bord API',
      version: '1.0.0',
      description: 'å¤§å­¦ã‚µãƒ¼ã‚¯ãƒ«ç·´ç¿’è©¦åˆãƒãƒƒãƒãƒ³ã‚°ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ  API',
      contact: {
        name: 'API Support',
        email: 'support@circle-bord.com'
      }
    },
    servers: [
      {
        url: 'http://localhost:3001/api',
        description: 'é–‹ç™ºã‚µãƒ¼ãƒãƒ¼'
      },
      {
        url: 'https://api.circle-bord.com',
        description: 'æœ¬ç•ªã‚µãƒ¼ãƒãƒ¼'
      }
    ],
    components: {
      securitySchemes: {
        bearerAuth: {
          type: 'http',
          scheme: 'bearer',
          bearerFormat: 'JWT'
        }
      },
      schemas: {
        Error: {
          type: 'object',
          properties: {
            message: {
              type: 'string',
              description: 'ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸'
            },
            code: {
              type: 'string',
              description: 'ã‚¨ãƒ©ãƒ¼ã‚³ãƒ¼ãƒ‰'
            },
            statusCode: {
              type: 'integer',
              description: 'HTTPã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚³ãƒ¼ãƒ‰'
            }
          }
        },
        Pagination: {
          type: 'object',
          properties: {
            page: {
              type: 'integer',
              description: 'ç¾åœ¨ã®ãƒšãƒ¼ã‚¸ç•ªå·'
            },
            limit: {
              type: 'integer',
              description: '1ãƒšãƒ¼ã‚¸ã‚ãŸã‚Šã®ä»¶æ•°'
            },
            total: {
              type: 'integer',
              description: 'ç·ä»¶æ•°'
            },
            totalPages: {
              type: 'integer',
              description: 'ç·ãƒšãƒ¼ã‚¸æ•°'
            }
          }
        }
      }
    },
    tags: [
      {
        name: 'Auth',
        description: 'èªè¨¼é–¢é€£ã®API'
      },
      {
        name: 'Users',
        description: 'ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç†API'
      },
      {
        name: 'Teams',
        description: 'ãƒãƒ¼ãƒ ç®¡ç†API'
      },
      {
        name: 'Games',
        description: 'è©¦åˆç®¡ç†API'
      },
      {
        name: 'Matches',
        description: 'ãƒãƒƒãƒãƒ³ã‚°ç®¡ç†API'
      },
      {
        name: 'Master',
        description: 'ãƒã‚¹ã‚¿ãƒ‡ãƒ¼ã‚¿API'
      }
    ]
  },
  apis: ['./src/routes/**/*.ts', './src/controllers/**/*.ts']
};

export const specs = swaggerJsdoc(options);
```

### 3. Swagger UIçµ±åˆ

**src/app.tsæ›´æ–°:**
```typescript
import swaggerUi from 'swagger-ui-express';
import { specs } from './config/swagger';

// Swagger UI
app.use('/api-docs', swaggerUi.serve, swaggerUi.setup(specs, {
  customCss: '.swagger-ui .topbar { display: none }',
  customSiteTitle: 'Circle-Bord API Documentation'
}));
```

### 4. APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆæ–‡æ›¸åŒ–

**src/controllers/UserController.tsï¼ˆæ–‡æ›¸åŒ–è¿½åŠ ï¼‰:**
```typescript
/**
 * @swagger
 * components:
 *   schemas:
 *     User:
 *       type: object
 *       required:
 *         - email
 *         - name
 *         - password
 *       properties:
 *         id:
 *           type: string
 *           format: uuid
 *           description: ãƒ¦ãƒ¼ã‚¶ãƒ¼ID
 *         email:
 *           type: string
 *           format: email
 *           description: ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹
 *         name:
 *           type: string
 *           description: ãƒ¦ãƒ¼ã‚¶ãƒ¼å
 *         isActive:
 *           type: boolean
 *           description: ã‚¢ã‚¯ãƒ†ã‚£ãƒ–çŠ¶æ…‹
 *         createdAt:
 *           type: string
 *           format: date-time
 *           description: ä½œæˆæ—¥æ™‚
 *         updatedAt:
 *           type: string
 *           format: date-time
 *           description: æ›´æ–°æ—¥æ™‚
 */

export class UserController {
  /**
   * @swagger
   * /users:
   *   get:
   *     summary: ãƒ¦ãƒ¼ã‚¶ãƒ¼ä¸€è¦§å–å¾—
   *     tags: [Users]
   *     security:
   *       - bearerAuth: []
   *     parameters:
   *       - in: query
   *         name: page
   *         schema:
   *           type: integer
   *           default: 1
   *         description: ãƒšãƒ¼ã‚¸ç•ªå·
   *       - in: query
   *         name: limit
   *         schema:
   *           type: integer
   *           default: 10
   *         description: 1ãƒšãƒ¼ã‚¸ã‚ãŸã‚Šã®ä»¶æ•°
   *     responses:
   *       200:
   *         description: ãƒ¦ãƒ¼ã‚¶ãƒ¼ä¸€è¦§
   *         content:
   *           application/json:
   *             schema:
   *               type: object
   *               properties:
   *                 data:
   *                   type: array
   *                   items:
   *                     $ref: '#/components/schemas/User'
   *                 pagination:
   *                   $ref: '#/components/schemas/Pagination'
   *       401:
   *         description: èªè¨¼ã‚¨ãƒ©ãƒ¼
   *         content:
   *           application/json:
   *             schema:
   *               $ref: '#/components/schemas/Error'
   */
  async getAll = async (req: Request, res: Response, next: NextFunction) => {
    // å®Ÿè£…...
  };

  /**
   * @swagger
   * /users/{id}:
   *   get:
   *     summary: ãƒ¦ãƒ¼ã‚¶ãƒ¼è©³ç´°å–å¾—
   *     tags: [Users]
   *     security:
   *       - bearerAuth: []
   *     parameters:
   *       - in: path
   *         name: id
   *         required: true
   *         schema:
   *           type: string
   *           format: uuid
   *         description: ãƒ¦ãƒ¼ã‚¶ãƒ¼ID
   *     responses:
   *       200:
   *         description: ãƒ¦ãƒ¼ã‚¶ãƒ¼è©³ç´°
   *         content:
   *           application/json:
   *             schema:
   *               $ref: '#/components/schemas/User'
   *       404:
   *         description: ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“
   *         content:
   *           application/json:
   *             schema:
   *               $ref: '#/components/schemas/Error'
   */
  async getById = async (req: Request, res: Response, next: NextFunction) => {
    // å®Ÿè£…...
  };

  /**
   * @swagger
   * /users:
   *   post:
   *     summary: ãƒ¦ãƒ¼ã‚¶ãƒ¼ä½œæˆ
   *     tags: [Users]
   *     requestBody:
   *       required: true
   *       content:
   *         application/json:
   *           schema:
   *             type: object
   *             required:
   *               - email
   *               - password
   *               - name
   *             properties:
   *               email:
   *                 type: string
   *                 format: email
   *                 example: user@example.com
   *               password:
   *                 type: string
   *                 format: password
   *                 minLength: 6
   *                 example: password123
   *               name:
   *                 type: string
   *                 example: å±±ç”°å¤ªéƒ
   *     responses:
   *       201:
   *         description: ãƒ¦ãƒ¼ã‚¶ãƒ¼ä½œæˆæˆåŠŸ
   *         content:
   *           application/json:
   *             schema:
   *               $ref: '#/components/schemas/User'
   *       400:
   *         description: ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚¨ãƒ©ãƒ¼
   *       409:
   *         description: ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹é‡è¤‡
   */
  async create = async (req: Request, res: Response, next: NextFunction) => {
    // å®Ÿè£…...
  };
}
```

### 5. Game APIæ–‡æ›¸åŒ–ä¾‹

```typescript
/**
 * @swagger
 * components:
 *   schemas:
 *     Game:
 *       type: object
 *       properties:
 *         id:
 *           type: integer
 *           description: è©¦åˆID
 *         teamId:
 *           type: integer
 *           description: ãƒãƒ¼ãƒ ID
 *         sportId:
 *           type: integer
 *           description: ã‚¹ãƒãƒ¼ãƒ„ID
 *         locationId:
 *           type: integer
 *           description: å ´æ‰€ID
 *         date:
 *           type: string
 *           format: date
 *           description: è©¦åˆæ—¥
 *         startTime:
 *           type: string
 *           format: time
 *           description: é–‹å§‹æ™‚åˆ»
 *         endTime:
 *           type: string
 *           format: time
 *           description: çµ‚äº†æ™‚åˆ»
 *         status:
 *           type: string
 *           enum: [open, matched, completed, cancelled]
 *           description: ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹
 *         contact:
 *           type: string
 *           description: é€£çµ¡å…ˆ
 *         description:
 *           type: string
 *           description: è©³ç´°èª¬æ˜
 *         maxParticipants:
 *           type: integer
 *           description: æœ€å¤§å‚åŠ äººæ•°
 * 
 * /games/search:
 *   get:
 *     summary: è©¦åˆæ¤œç´¢
 *     tags: [Games]
 *     parameters:
 *       - in: query
 *         name: sportId
 *         schema:
 *           type: integer
 *         description: ã‚¹ãƒãƒ¼ãƒ„ID
 *       - in: query
 *         name: locationId
 *         schema:
 *           type: integer
 *         description: å ´æ‰€ID
 *       - in: query
 *         name: date
 *         schema:
 *           type: string
 *           format: date
 *         description: è©¦åˆæ—¥
 *       - in: query
 *         name: status
 *         schema:
 *           type: string
 *           enum: [open, matched, completed, cancelled]
 *         description: ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹
 *     responses:
 *       200:
 *         description: æ¤œç´¢çµæœ
 *         content:
 *           application/json:
 *             schema:
 *               type: array
 *               items:
 *                 $ref: '#/components/schemas/Game'
 */
```

### 6. èªè¨¼APIæ–‡æ›¸åŒ–

```typescript
/**
 * @swagger
 * /auth/login:
 *   post:
 *     summary: ãƒ­ã‚°ã‚¤ãƒ³
 *     tags: [Auth]
 *     requestBody:
 *       required: true
 *       content:
 *         application/json:
 *           schema:
 *             type: object
 *             required:
 *               - email
 *               - password
 *             properties:
 *               email:
 *                 type: string
 *                 format: email
 *                 example: user@example.com
 *               password:
 *                 type: string
 *                 format: password
 *                 example: password123
 *     responses:
 *       200:
 *         description: ãƒ­ã‚°ã‚¤ãƒ³æˆåŠŸ
 *         content:
 *           application/json:
 *             schema:
 *               type: object
 *               properties:
 *                 token:
 *                   type: string
 *                   description: JWTãƒˆãƒ¼ã‚¯ãƒ³
 *                 user:
 *                   $ref: '#/components/schemas/User'
 *       401:
 *         description: èªè¨¼å¤±æ•—
 */
```

### 7. APIãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆè‡ªå‹•ç”Ÿæˆã‚¹ã‚¯ãƒªãƒ—ãƒˆ

**scripts/generate-api-spec.ts:**
```typescript
import fs from 'fs';
import { specs } from '../src/config/swagger';

const outputPath = './docs/api/openapi.json';

fs.writeFileSync(outputPath, JSON.stringify(specs, null, 2));
console.log(`APIä»•æ§˜æ›¸ã‚’ç”Ÿæˆã—ã¾ã—ãŸ: ${outputPath}`);
```

## âœ… å—ã‘å…¥ã‚Œæ¡ä»¶

- [ ] Swagger UIãŒ `/api-docs` ã§ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½
- [ ] ã™ã¹ã¦ã®APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆãŒæ–‡æ›¸åŒ–ã•ã‚Œã¦ã„ã‚‹
- [ ] ãƒªã‚¯ã‚¨ã‚¹ãƒˆ/ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã®å‹ãŒå®šç¾©ã•ã‚Œã¦ã„ã‚‹
- [ ] ã‚¨ãƒ©ãƒ¼ãƒ¬ã‚¹ãƒãƒ³ã‚¹ãŒæ–‡æ›¸åŒ–ã•ã‚Œã¦ã„ã‚‹
- [ ] èªè¨¼ãŒå¿…è¦ãªã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆãŒæ˜ç¤ºã•ã‚Œã¦ã„ã‚‹
- [ ] ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿ãŒæä¾›ã•ã‚Œã¦ã„ã‚‹
- [ ] OpenAPIä»•æ§˜æ›¸ãŒã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆå¯èƒ½

## ğŸ”§ æŠ€è¡“è¦ä»¶

- OpenAPI 3.0
- swagger-jsdoc
- swagger-ui-express

## â±ï¸ è¦‹ç©ã‚‚ã‚Šæ™‚é–“
8æ™‚é–“

## ğŸ”— ä¾å­˜é–¢ä¿‚
- P1-005: CRUD APIå®Ÿè£…ï¼ˆå®Œäº†å¿…é ˆï¼‰

## ğŸ§ª ãƒ†ã‚¹ãƒˆæ–¹é‡

### Swagger UIç¢ºèª
1. `http://localhost:3001/api-docs` ã«ã‚¢ã‚¯ã‚»ã‚¹
2. å„ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã®æ–‡æ›¸ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª
3. "Try it out"æ©Ÿèƒ½ã§APIãƒ†ã‚¹ãƒˆãŒå¯èƒ½ãªã“ã¨ã‚’ç¢ºèª
4. èªè¨¼ãƒˆãƒ¼ã‚¯ãƒ³ãŒè¨­å®šã§ãã‚‹ã“ã¨ã‚’ç¢ºèª

### OpenAPIä»•æ§˜æ¤œè¨¼
```bash
# OpenAPIä»•æ§˜æ›¸ã®æ¤œè¨¼
npx @apidevtools/swagger-cli validate docs/api/openapi.json
```

## ğŸ“Œ æ³¨æ„äº‹é …

- ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãªã©æ©Ÿå¯†æƒ…å ±ã¯ã‚µãƒ³ãƒ—ãƒ«ã«å«ã‚ãªã„
- ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã®ã‚µãƒ³ãƒ—ãƒ«ã¯å®Ÿéš›ã®ãƒ‡ãƒ¼ã‚¿æ§‹é€ ã¨ä¸€è‡´ã•ã›ã‚‹
- éæ¨å¥¨ï¼ˆdeprecatedï¼‰ã®APIã¯æ˜ç¤ºã™ã‚‹
- ãƒãƒ¼ã‚¸ãƒ§ãƒ‹ãƒ³ã‚°æˆ¦ç•¥ã‚’æ¤œè¨ã™ã‚‹

## ğŸ·ï¸ ãƒ©ãƒ™ãƒ«
`documentation`, `swagger`, `api`, `phase1`

## ğŸ“… ä½œæˆæ—¥
2025-09-08