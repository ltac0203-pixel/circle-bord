# チケット P1-001: MariaDB環境セットアップ

## 📋 概要
ローカル開発環境にMariaDBをインストールし、Circle-Bordプロジェクト用のデータベースとユーザーを作成する。

## 🎯 目標
- MariaDB 10.6以上のローカルインストール
- 開発用データベースの作成
- アプリケーション用ユーザーの設定
- 接続確認とテスト

## 📝 詳細説明

### 1. MariaDBインストール
プラットフォームに応じたMariaDBのインストール：

**Windows:**
```bash
# MariaDB公式サイトからMSIインストーラーをダウンロード
# https://mariadb.org/download/
```

**macOS:**
```bash
brew install mariadb
brew services start mariadb
```

**Linux (Ubuntu/Debian):**
```bash
sudo apt update
sudo apt install mariadb-server mariadb-client
sudo systemctl start mariadb
sudo systemctl enable mariadb
```

### 2. 初期セキュリティ設定
```bash
sudo mysql_secure_installation
# rootパスワード設定
# 匿名ユーザー削除
# リモートrootログイン無効化
# テストデータベース削除
```

### 3. データベースとユーザー作成
```sql
-- rootユーザーでログイン
mysql -u root -p

-- データベース作成
CREATE DATABASE circle_bord 
  CHARACTER SET utf8mb4 
  COLLATE utf8mb4_unicode_ci;

-- アプリケーション用ユーザー作成
CREATE USER 'circle_user'@'localhost' 
  IDENTIFIED BY 'secure_password_here';

-- 権限付与
GRANT ALL PRIVILEGES ON circle_bord.* 
  TO 'circle_user'@'localhost';

-- 開発用読み取り専用ユーザー（オプション）
CREATE USER 'circle_reader'@'localhost' 
  IDENTIFIED BY 'reader_password_here';
  
GRANT SELECT ON circle_bord.* 
  TO 'circle_reader'@'localhost';

-- 権限の反映
FLUSH PRIVILEGES;

-- 確認
SHOW DATABASES;
SELECT User, Host FROM mysql.user;
EXIT;
```

### 4. 接続テスト
```bash
# circle_userでの接続確認
mysql -u circle_user -p circle_bord

# 接続情報の確認
SELECT CONNECTION_ID();
SELECT DATABASE();
SHOW TABLES;
EXIT;
```

### 5. 環境変数設定
`.env.local`ファイルの作成：
```env
DB_HOST=localhost
DB_PORT=3306
DB_NAME=circle_bord
DB_USER=circle_user
DB_PASSWORD=secure_password_here
DB_CHARSET=utf8mb4
```

## ✅ 受け入れ条件

- [ ] MariaDB 10.6以上がインストールされている
- [ ] `circle_bord`データベースが作成されている
- [ ] `circle_user`ユーザーが作成され、適切な権限が付与されている
- [ ] アプリケーションユーザーでデータベースに接続できる
- [ ] `.env.local`ファイルに接続情報が設定されている
- [ ] MariaDBサービスが自動起動設定されている

## 🔧 技術要件

- MariaDB 10.6以上
- UTF8MB4文字セット対応
- ローカルホスト接続のみ許可
- 適切なパスワードポリシー

## ⏱️ 見積もり時間
8時間

## 🔗 依存関係
なし（最初のタスク）

## 🧪 テスト方針

### 接続テストスクリプト
`test-db-connection.js`:
```javascript
const mysql = require('mysql2');
require('dotenv').config({ path: '.env.local' });

const connection = mysql.createConnection({
  host: process.env.DB_HOST,
  port: process.env.DB_PORT,
  user: process.env.DB_USER,
  password: process.env.DB_PASSWORD,
  database: process.env.DB_NAME
});

connection.connect((err) => {
  if (err) {
    console.error('接続エラー:', err);
    process.exit(1);
  }
  console.log('✅ MariaDB接続成功');
  
  connection.query('SELECT VERSION()', (err, results) => {
    if (!err) {
      console.log('MariaDBバージョン:', results[0]['VERSION()']);
    }
    connection.end();
  });
});
```

## 📌 注意事項

- パスワードは本番環境では必ず強固なものを使用すること
- 開発環境でもパスワードをコードにハードコーディングしない
- `.env.local`ファイルは`.gitignore`に追加すること
- 定期的にMariaDBのアップデートを確認すること

## 🏷️ ラベル
`setup`, `database`, `infrastructure`, `phase1`

## 📅 作成日
2025-09-08