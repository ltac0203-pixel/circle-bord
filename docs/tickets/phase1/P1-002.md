# ãƒã‚±ãƒƒãƒˆ P1-002: ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆåˆæœŸåŒ–

## ğŸ“‹ æ¦‚è¦
TypeScript + Express + TypeORMã‚’ä½¿ç”¨ã—ãŸãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰APIã‚µãƒ¼ãƒãƒ¼ã®åˆæœŸãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã™ã‚‹ã€‚

## ğŸ¯ ç›®æ¨™
- Node.js/TypeScriptãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®åˆæœŸåŒ–
- Express.jsã‚µãƒ¼ãƒãƒ¼ã®åŸºæœ¬è¨­å®š
- TypeORMã®è¨­å®šã¨ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ¥ç¶š
- é–‹ç™ºç’°å¢ƒã®æ§‹ç¯‰ï¼ˆhot reloadå¯¾å¿œï¼‰

## ğŸ“ è©³ç´°èª¬æ˜

### 1. ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªä½œæˆ
```bash
# ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’åˆ¥ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã¨ã—ã¦ä½œæˆ
mkdir circle-bord-backend
cd circle-bord-backend

# Gitãƒªãƒã‚¸ãƒˆãƒªåˆæœŸåŒ–
git init
```

### 2. package.jsonåˆæœŸåŒ–ã¨ä¾å­˜é–¢ä¿‚ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
```bash
# package.jsonä½œæˆ
npm init -y

# æœ¬ç•ªä¾å­˜é–¢ä¿‚
npm install express cors helmet morgan compression
npm install typeorm reflect-metadata mysql2
npm install dotenv
npm install bcrypt jsonwebtoken
npm install class-validator class-transformer

# é–‹ç™ºä¾å­˜é–¢ä¿‚
npm install -D typescript @types/node
npm install -D @types/express @types/cors @types/morgan @types/compression
npm install -D @types/bcrypt @types/jsonwebtoken
npm install -D ts-node nodemon
npm install -D @typescript-eslint/parser @typescript-eslint/eslint-plugin
npm install -D prettier eslint
```

### 3. TypeScriptè¨­å®šï¼ˆtsconfig.jsonï¼‰
```json
{
  "compilerOptions": {
    "target": "ES2020",
    "module": "commonjs",
    "lib": ["ES2020"],
    "outDir": "./dist",
    "rootDir": "./src",
    "strict": true,
    "esModuleInterop": true,
    "skipLibCheck": true,
    "forceConsistentCasingInFileNames": true,
    "experimentalDecorators": true,
    "emitDecoratorMetadata": true,
    "resolveJsonModule": true,
    "sourceMap": true,
    "noImplicitAny": true,
    "strictPropertyInitialization": false
  },
  "include": ["src/**/*"],
  "exclude": ["node_modules", "dist"]
}
```

### 4. ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ§‹é€ ä½œæˆ
```
circle-bord-backend/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ config/
â”‚   â”‚   â”œâ”€â”€ database.ts
â”‚   â”‚   â””â”€â”€ config.ts
â”‚   â”œâ”€â”€ entities/
â”‚   â”‚   â””â”€â”€ index.ts
â”‚   â”œâ”€â”€ repositories/
â”‚   â”œâ”€â”€ services/
â”‚   â”œâ”€â”€ controllers/
â”‚   â”œâ”€â”€ middlewares/
â”‚   â”‚   â””â”€â”€ errorHandler.ts
â”‚   â”œâ”€â”€ routes/
â”‚   â”‚   â””â”€â”€ index.ts
â”‚   â”œâ”€â”€ utils/
â”‚   â”‚   â””â”€â”€ logger.ts
â”‚   â””â”€â”€ app.ts
â”‚   â””â”€â”€ server.ts
â”œâ”€â”€ .env.example
â”œâ”€â”€ .env.local
â”œâ”€â”€ .gitignore
â”œâ”€â”€ .eslintrc.json
â”œâ”€â”€ .prettierrc
â”œâ”€â”€ nodemon.json
â”œâ”€â”€ package.json
â””â”€â”€ tsconfig.json
```

### 5. åŸºæœ¬çš„ãªã‚µãƒ¼ãƒãƒ¼å®Ÿè£…

**src/config/database.ts:**
```typescript
import { DataSource, DataSourceOptions } from 'typeorm';
import * as dotenv from 'dotenv';

dotenv.config({ path: '.env.local' });

const config: DataSourceOptions = {
  type: 'mariadb',
  host: process.env.DB_HOST || 'localhost',
  port: parseInt(process.env.DB_PORT || '3306'),
  username: process.env.DB_USER || 'circle_user',
  password: process.env.DB_PASSWORD,
  database: process.env.DB_NAME || 'circle_bord',
  synchronize: process.env.NODE_ENV === 'development',
  logging: process.env.NODE_ENV === 'development',
  entities: ['src/entities/**/*.ts'],
  migrations: ['src/migrations/**/*.ts'],
  subscribers: ['src/subscribers/**/*.ts'],
};

export const AppDataSource = new DataSource(config);
```

**src/app.ts:**
```typescript
import express, { Application } from 'express';
import cors from 'cors';
import helmet from 'helmet';
import morgan from 'morgan';
import compression from 'compression';
import { errorHandler } from './middlewares/errorHandler';
import routes from './routes';

const app: Application = express();

// ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢
app.use(helmet());
app.use(cors());
app.use(compression());
app.use(morgan('dev'));
app.use(express.json());
app.use(express.urlencoded({ extended: true }));

// ãƒ«ãƒ¼ãƒˆ
app.use('/api', routes);

// ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯
app.get('/health', (req, res) => {
  res.json({ status: 'OK', timestamp: new Date().toISOString() });
});

// ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
app.use(errorHandler);

export default app;
```

**src/server.ts:**
```typescript
import 'reflect-metadata';
import { AppDataSource } from './config/database';
import app from './app';
import * as dotenv from 'dotenv';

dotenv.config({ path: '.env.local' });

const PORT = process.env.PORT || 3001;

const startServer = async () => {
  try {
    // ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ¥ç¶š
    await AppDataSource.initialize();
    console.log('âœ… ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ¥ç¶šæˆåŠŸ');

    // ã‚µãƒ¼ãƒãƒ¼èµ·å‹•
    app.listen(PORT, () => {
      console.log(`ğŸš€ ã‚µãƒ¼ãƒãƒ¼èµ·å‹•: http://localhost:${PORT}`);
      console.log(`ğŸ“ APIæ–‡æ›¸: http://localhost:${PORT}/api-docs`);
    });
  } catch (error) {
    console.error('âŒ ã‚µãƒ¼ãƒãƒ¼èµ·å‹•ã‚¨ãƒ©ãƒ¼:', error);
    process.exit(1);
  }
};

startServer();
```

### 6. é–‹ç™ºç’°å¢ƒè¨­å®š

**nodemon.json:**
```json
{
  "watch": ["src"],
  "ext": "ts",
  "ignore": ["src/**/*.spec.ts"],
  "exec": "ts-node ./src/server.ts"
}
```

**package.jsonã‚¹ã‚¯ãƒªãƒ—ãƒˆ:**
```json
{
  "scripts": {
    "dev": "nodemon",
    "build": "tsc",
    "start": "node dist/server.js",
    "typeorm": "typeorm-ts-node-commonjs",
    "migration:generate": "npm run typeorm migration:generate -- -d src/config/database.ts",
    "migration:run": "npm run typeorm migration:run -- -d src/config/database.ts",
    "lint": "eslint . --ext .ts",
    "format": "prettier --write \"src/**/*.ts\""
  }
}
```

## âœ… å—ã‘å…¥ã‚Œæ¡ä»¶

- [ ] TypeScriptãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãŒæ­£ã—ãè¨­å®šã•ã‚Œã¦ã„ã‚‹
- [ ] Express ã‚µãƒ¼ãƒãƒ¼ãŒèµ·å‹•ã™ã‚‹ï¼ˆãƒãƒ¼ãƒˆ3001ï¼‰
- [ ] TypeORMã§ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«æ¥ç¶šã§ãã‚‹
- [ ] ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ `/health` ãŒå‹•ä½œã™ã‚‹
- [ ] Hot reloadï¼ˆnodemonï¼‰ãŒæ©Ÿèƒ½ã™ã‚‹
- [ ] ESLintã¨PrettierãŒè¨­å®šã•ã‚Œã¦ã„ã‚‹
- [ ] ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ§‹é€ ãŒæ•´ç†ã•ã‚Œã¦ã„ã‚‹

## ğŸ”§ æŠ€è¡“è¦ä»¶

- Node.js 20ä»¥ä¸Š
- TypeScript 5.0ä»¥ä¸Š
- Express.js 4.x
- TypeORM 0.3.x
- MariaDBæ¥ç¶šå¯¾å¿œ

## â±ï¸ è¦‹ç©ã‚‚ã‚Šæ™‚é–“
8æ™‚é–“

## ğŸ”— ä¾å­˜é–¢ä¿‚
- P1-001: MariaDBç’°å¢ƒã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ï¼ˆå®Œäº†å¿…é ˆï¼‰

## ğŸ§ª ãƒ†ã‚¹ãƒˆæ–¹é‡

### èµ·å‹•ç¢ºèª
```bash
# é–‹ç™ºã‚µãƒ¼ãƒãƒ¼èµ·å‹•
npm run dev

# ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯
curl http://localhost:3001/health

# TypeScript ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ç¢ºèª
npm run build

# Lintå®Ÿè¡Œ
npm run lint
```

### æ¥ç¶šãƒ†ã‚¹ãƒˆ
```typescript
// test/db-connection.test.ts
import { AppDataSource } from '../src/config/database';

describe('Database Connection', () => {
  it('should connect to database', async () => {
    await expect(AppDataSource.initialize()).resolves.toBeTruthy();
    await AppDataSource.destroy();
  });
});
```

## ğŸ“Œ æ³¨æ„äº‹é …

- `.env.local`ãƒ•ã‚¡ã‚¤ãƒ«ã¯`.gitignore`ã«å¿…ãšè¿½åŠ 
- TypeORMã®`synchronize`ã¯æœ¬ç•ªç’°å¢ƒã§ã¯å¿…ãšfalseã«è¨­å®š
- CORSã®è¨­å®šã¯æœ¬ç•ªç’°å¢ƒã§ã¯é©åˆ‡ã«åˆ¶é™ã™ã‚‹ã“ã¨
- ãƒãƒ¼ãƒˆç•ªå·ã¯ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ï¼ˆ3000ï¼‰ã¨é‡è¤‡ã—ãªã„ã‚ˆã†ã«è¨­å®š

## ğŸ·ï¸ ãƒ©ãƒ™ãƒ«
`setup`, `backend`, `infrastructure`, `phase1`

## ğŸ“… ä½œæˆæ—¥
2025-09-08