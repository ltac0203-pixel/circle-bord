# ãƒã‚±ãƒƒãƒˆ P4-001: Dashboard.tsxãƒªãƒ•ã‚¡ã‚¯ã‚¿

## ğŸ“‹ æ¦‚è¦
Dashboard.tsxã‚’ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‹ã‚‰APIé€£æºã«å®Œå…¨ç§»è¡Œã—ã€ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãƒ‡ãƒ¼ã‚¿è¡¨ç¤ºã‚’å®Ÿç¾ã™ã‚‹ã€‚

## ğŸ¯ ç›®æ¨™
- ãƒ­ãƒ¼ã‚«ãƒ«stateå‰Šé™¤
- APIé€£æºå®Ÿè£…
- ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãƒ‡ãƒ¼ã‚¿è¡¨ç¤º
- ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆåˆ†å‰²

## ğŸ“ è©³ç´°èª¬æ˜

### 1. æ–°ã—ã„Dashboardå®Ÿè£…

**src/components/Dashboard.tsx:**
```typescript
import React, { useState, useEffect } from 'react';
import { useAuth } from '../contexts/AuthContext';
import { useTeam } from '../contexts/TeamContext';
import { useGames } from '../hooks/useGames';
import { useMatches } from '../hooks/useMatches';
import { GameList } from './game/GameList';
import { GameForm } from './game/GameForm';
import { MatchList } from './match/MatchList';
import { TeamStatistics } from './team/TeamStatistics';
import { FilterPanel } from './common/FilterPanel';

export const Dashboard: React.FC = () => {
  const { user } = useAuth();
  const { currentTeam } = useTeam();
  const [activeTab, setActiveTab] = useState<'games' | 'matches' | 'stats'>('games');
  const [filters, setFilters] = useState<GameFilters>({
    status: 'open',
    sportId: null,
    date: null
  });

  const {
    data: games,
    isLoading: gamesLoading,
    error: gamesError,
    refetch: refetchGames
  } = useGames(currentTeam?.id, filters);

  const {
    data: matches,
    isLoading: matchesLoading,
    refetch: refetchMatches
  } = useMatches(currentTeam?.id);

  if (!currentTeam) {
    return (
      <div className="no-team-message">
        <h2>ãƒãƒ¼ãƒ ã«æ‰€å±ã—ã¦ã„ã¾ã›ã‚“</h2>
        <p>ãƒãƒ¼ãƒ ã‚’ä½œæˆã™ã‚‹ã‹ã€æ‹›å¾…ã‚’å—ã‘ã¦ãã ã•ã„ã€‚</p>
        <CreateTeamButton />
      </div>
    );
  }

  return (
    <div className="dashboard">
      <div className="dashboard-header">
        <h1>ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</h1>
        <TeamSelector />
      </div>

      <div className="dashboard-tabs">
        <button
          className={`tab ${activeTab === 'games' ? 'active' : ''}`}
          onClick={() => setActiveTab('games')}
        >
          è©¦åˆç®¡ç†
        </button>
        <button
          className={`tab ${activeTab === 'matches' ? 'active' : ''}`}
          onClick={() => setActiveTab('matches')}
        >
          ãƒãƒƒãƒãƒ³ã‚°
        </button>
        <button
          className={`tab ${activeTab === 'stats' ? 'active' : ''}`}
          onClick={() => setActiveTab('stats')}
        >
          çµ±è¨ˆ
        </button>
      </div>

      <div className="dashboard-content">
        {activeTab === 'games' && (
          <div className="games-section">
            <FilterPanel
              filters={filters}
              onFilterChange={setFilters}
            />
            
            <GameForm
              teamId={currentTeam.id}
              onGameCreated={refetchGames}
            />
            
            {gamesLoading ? (
              <LoadingSpinner />
            ) : gamesError ? (
              <ErrorMessage error={gamesError} />
            ) : (
              <GameList
                games={games || []}
                onUpdate={refetchGames}
              />
            )}
          </div>
        )}

        {activeTab === 'matches' && (
          <div className="matches-section">
            {matchesLoading ? (
              <LoadingSpinner />
            ) : (
              <MatchList
                matches={matches || []}
                onUpdate={refetchMatches}
              />
            )}
          </div>
        )}

        {activeTab === 'stats' && (
          <TeamStatistics teamId={currentTeam.id} />
        )}
      </div>
    </div>
  );
};
```

### 2. GameListã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆåˆ†é›¢

**src/components/game/GameList.tsx:**
```typescript
interface GameListProps {
  games: Game[];
  onUpdate: () => void;
}

export const GameList: React.FC<GameListProps> = ({ games, onUpdate }) => {
  const [selectedGame, setSelectedGame] = useState<Game | null>(null);

  const handleDelete = async (gameId: number) => {
    if (window.confirm('ã“ã®è©¦åˆã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ')) {
      try {
        await gameService.deleteGame(gameId);
        toast.success('è©¦åˆã‚’å‰Šé™¤ã—ã¾ã—ãŸ');
        onUpdate();
      } catch (error) {
        toast.error('å‰Šé™¤ã«å¤±æ•—ã—ã¾ã—ãŸ');
      }
    }
  };

  const handleStatusChange = async (gameId: number, status: GameStatus) => {
    try {
      await gameService.updateGameStatus(gameId, status);
      toast.success('ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚’æ›´æ–°ã—ã¾ã—ãŸ');
      onUpdate();
    } catch (error) {
      toast.error('æ›´æ–°ã«å¤±æ•—ã—ã¾ã—ãŸ');
    }
  };

  if (games.length === 0) {
    return (
      <div className="empty-state">
        <p>è©¦åˆãŒã‚ã‚Šã¾ã›ã‚“</p>
      </div>
    );
  }

  return (
    <div className="game-list">
      {games.map(game => (
        <GameCard
          key={game.id}
          game={game}
          onEdit={() => setSelectedGame(game)}
          onDelete={() => handleDelete(game.id)}
          onStatusChange={(status) => handleStatusChange(game.id, status)}
        />
      ))}

      {selectedGame && (
        <GameEditModal
          game={selectedGame}
          onClose={() => setSelectedGame(null)}
          onSave={onUpdate}
        />
      )}
    </div>
  );
};
```

### 3. GameFormã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ

**src/components/game/GameForm.tsx:**
```typescript
interface GameFormProps {
  teamId: number;
  onGameCreated: () => void;
}

export const GameForm: React.FC<GameFormProps> = ({ teamId, onGameCreated }) => {
  const [isOpen, setIsOpen] = useState(false);
  const [formData, setFormData] = useState<CreateGameDto>({
    sportId: 0,
    locationId: 0,
    date: '',
    startTime: '',
    endTime: '',
    contact: '',
    description: '',
    maxParticipants: undefined
  });

  const { data: sports } = useSports();
  const { data: locations } = useLocations();

  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault();
    
    try {
      await gameService.createGame(teamId, formData);
      toast.success('è©¦åˆã‚’ä½œæˆã—ã¾ã—ãŸ');
      setIsOpen(false);
      resetForm();
      onGameCreated();
    } catch (error) {
      toast.error('è©¦åˆã®ä½œæˆã«å¤±æ•—ã—ã¾ã—ãŸ');
    }
  };

  const resetForm = () => {
    setFormData({
      sportId: 0,
      locationId: 0,
      date: '',
      startTime: '',
      endTime: '',
      contact: '',
      description: '',
      maxParticipants: undefined
    });
  };

  return (
    <>
      <button
        className="btn-primary"
        onClick={() => setIsOpen(true)}
      >
        æ–°ã—ã„è©¦åˆã‚’ä½œæˆ
      </button>

      {isOpen && (
        <Modal onClose={() => setIsOpen(false)}>
          <form onSubmit={handleSubmit} className="game-form">
            <h3>è©¦åˆä½œæˆ</h3>
            
            <select
              value={formData.sportId}
              onChange={(e) => setFormData({
                ...formData,
                sportId: parseInt(e.target.value)
              })}
              required
            >
              <option value="">ã‚¹ãƒãƒ¼ãƒ„ã‚’é¸æŠ</option>
              {sports?.map(sport => (
                <option key={sport.id} value={sport.id}>
                  {sport.name}
                </option>
              ))}
            </select>

            <select
              value={formData.locationId}
              onChange={(e) => setFormData({
                ...formData,
                locationId: parseInt(e.target.value)
              })}
              required
            >
              <option value="">å ´æ‰€ã‚’é¸æŠ</option>
              {locations?.map(location => (
                <option key={location.id} value={location.id}>
                  {location.name}
                </option>
              ))}
            </select>

            <input
              type="date"
              value={formData.date}
              onChange={(e) => setFormData({
                ...formData,
                date: e.target.value
              })}
              required
            />

            <input
              type="time"
              value={formData.startTime}
              onChange={(e) => setFormData({
                ...formData,
                startTime: e.target.value
              })}
              required
            />

            <textarea
              placeholder="è©³ç´°èª¬æ˜"
              value={formData.description}
              onChange={(e) => setFormData({
                ...formData,
                description: e.target.value
              })}
            />

            <div className="form-actions">
              <button type="button" onClick={() => setIsOpen(false)}>
                ã‚­ãƒ£ãƒ³ã‚»ãƒ«
              </button>
              <button type="submit">ä½œæˆ</button>
            </div>
          </form>
        </Modal>
      )}
    </>
  );
};
```

## âœ… å—ã‘å…¥ã‚Œæ¡ä»¶

- [ ] ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚’ä½¿ç”¨ã—ãªã„
- [ ] APIã‹ã‚‰ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ãƒ»è¡¨ç¤º
- [ ] ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ›´æ–°ãŒæ©Ÿèƒ½ã™ã‚‹
- [ ] ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ãŒé©åˆ‡
- [ ] ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°çŠ¶æ…‹ãŒè¡¨ç¤ºã•ã‚Œã‚‹
- [ ] ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãŒé©åˆ‡ã«åˆ†å‰²ã•ã‚Œã‚‹

## ğŸ”§ æŠ€è¡“è¦ä»¶

- React hooks
- APIé€£æº
- çŠ¶æ…‹ç®¡ç†
- ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°

## â±ï¸ è¦‹ç©ã‚‚ã‚Šæ™‚é–“
12æ™‚é–“

## ğŸ”— ä¾å­˜é–¢ä¿‚
- P2-004: AuthContextå®Œå…¨ãƒªãƒ•ã‚¡ã‚¯ã‚¿
- P3-004: ãƒãƒ¼ãƒ åˆ‡ã‚Šæ›¿ãˆæ©Ÿèƒ½

## ğŸ§ª ãƒ†ã‚¹ãƒˆæ–¹é‡

```typescript
describe('Dashboard', () => {
  it('should load games from API', async () => {
    const { getByText } = render(<Dashboard />);
    
    await waitFor(() => {
      expect(getByText('è©¦åˆç®¡ç†')).toBeInTheDocument();
    });
  });

  it('should handle API errors gracefully', async () => {
    mockApi.getGames.mockRejectedValue(new Error('API Error'));
    
    const { getByText } = render(<Dashboard />);
    
    await waitFor(() => {
      expect(getByText(/ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ/)).toBeInTheDocument();
    });
  });
});
```

## ğŸ“Œ æ³¨æ„äº‹é …

- ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–
- ä¸è¦ãªå†ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°é˜²æ­¢
- ã‚­ãƒ£ãƒƒã‚·ãƒ¥æˆ¦ç•¥

## ğŸ·ï¸ ãƒ©ãƒ™ãƒ«
`refactor`, `dashboard`, `api-integration`, `phase4`

## ğŸ“… ä½œæˆæ—¥
2025-09-08