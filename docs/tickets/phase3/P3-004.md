# ãƒã‚±ãƒƒãƒˆ P3-004: ãƒãƒ¼ãƒ åˆ‡ã‚Šæ›¿ãˆæ©Ÿèƒ½

## ğŸ“‹ æ¦‚è¦
è¤‡æ•°ãƒãƒ¼ãƒ ã«æ‰€å±ã™ã‚‹ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒã€ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãªãƒãƒ¼ãƒ ã‚’åˆ‡ã‚Šæ›¿ãˆã‚‹æ©Ÿèƒ½ã‚’å®Ÿè£…ã™ã‚‹ã€‚

## ğŸ¯ ç›®æ¨™
- ãƒãƒ¼ãƒ é¸æŠUI
- ç¾åœ¨ã®ãƒãƒ¼ãƒ ä¿æŒ
- ãƒãƒ¼ãƒ åˆ‡ã‚Šæ›¿ãˆæ™‚ã®çŠ¶æ…‹æ›´æ–°
- ãƒãƒ¼ãƒ åˆ¥ãƒ‡ãƒ¼ã‚¿ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°

## ğŸ“ è©³ç´°èª¬æ˜

### 1. ãƒãƒ¼ãƒ ã‚»ãƒ¬ã‚¯ã‚¿ãƒ¼ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ

**src/components/team/TeamSelector.tsx:**
```typescript
export const TeamSelector: React.FC = () => {
  const { user, currentTeam, setCurrentTeam } = useAuth();
  const [isOpen, setIsOpen] = useState(false);

  const handleTeamChange = (teamId: number) => {
    setCurrentTeam(teamId);
    localStorage.setItem('currentTeamId', teamId.toString());
    setIsOpen(false);
    window.location.reload(); // ãƒ‡ãƒ¼ã‚¿å†èª­ã¿è¾¼ã¿
  };

  if (!user || user.teams.length <= 1) {
    return null;
  }

  return (
    <div className="team-selector">
      <button
        className="team-selector-trigger"
        onClick={() => setIsOpen(!isOpen)}
      >
        <span className="team-name">{currentTeam?.name || 'ï¿½ï¿½ï¿½ãƒ¼ãƒ ã‚’é¸æŠ'}</span>
        <span className="team-role">({currentTeam?.role})</span>
        <ChevronDownIcon />
      </button>

      {isOpen && (
        <div className="team-selector-dropdown">
          {user.teams.map(team => (
            <button
              key={team.id}
              className={`team-option ${team.id === currentTeam?.id ? 'active' : ''}`}
              onClick={() => handleTeamChange(team.id)}
            >
              <span className="team-name">{team.name}</span>
              <span className="team-role">{team.role}</span>
            </button>
          ))}
        </div>
      )}
    </div>
  );
};
```

### 2. ãƒãƒ¼ãƒ ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆæ‹¡å¼µ

**src/contexts/TeamContext.tsx:**
```typescript
interface TeamContextType {
  currentTeam: Team | null;
  setCurrentTeam: (teamId: number) => void;
  switchTeam: (teamId: number) => Promise<void>;
  teamData: TeamData | null;
  isLoading: boolean;
}

export const TeamProvider: React.FC<Props> = ({ children }) => {
  const { user } = useAuth();
  const [currentTeam, setCurrentTeam] = useState<Team | null>(null);
  const [teamData, setTeamData] = useState<TeamData | null>(null);
  const [isLoading, setIsLoading] = useState(false);

  useEffect(() => {
    // ä¿å­˜ã•ã‚ŒãŸãƒãƒ¼ãƒ IDã‚’å¾©å…ƒ
    const savedTeamId = localStorage.getItem('currentTeamId');
    if (savedTeamId && user) {
      const team = user.teams.find(t => t.id === parseInt(savedTeamId));
      if (team) {
        setCurrentTeam(team);
      } else if (user.teams.length > 0) {
        setCurrentTeam(user.teams[0]);
      }
    }
  }, [user]);

  useEffect(() => {
    if (currentTeam) {
      loadTeamData(currentTeam.id);
    }
  }, [currentTeam]);

  const loadTeamData = async (teamId: number) => {
    setIsLoading(true);
    try {
      const data = await teamService.getTeamData(teamId);
      setTeamData(data);
    } catch (error) {
      console.error('ãƒãƒ¼ãƒ ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼:', error);
    } finally {
      setIsLoading(false);
    }
  };

  const switchTeam = async (teamId: number) => {
    const team = user?.teams.find(t => t.id === teamId);
    if (team) {
      setCurrentTeam(team);
      localStorage.setItem('currentTeamId', teamId.toString());
      await loadTeamData(teamId);
    }
  };

  return (
    <TeamContext.Provider value={{
      currentTeam,
      setCurrentTeam,
      switchTeam,
      teamData,
      isLoading
    }}>
      {children}
    </TeamContext.Provider>
  );
};
```

### 3. ãƒãƒ¼ãƒ åˆ¥ãƒ‡ãƒ¼ã‚¿ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°

**src/hooks/useTeamData.ts:**
```typescript
export const useTeamData = <T>(
  fetchFunction: (teamId: number) => Promise<T>,
  dependencies: any[] = []
) => {
  const { currentTeam } = useTeam();
  const [data, setData] = useState<T | null>(null);
  const [loading, setLoading] = useState(false);
  const [error, setError] = useState<Error | null>(null);

  useEffect(() => {
    if (!currentTeam) return;

    const loadData = async () => {
      setLoading(true);
      setError(null);
      try {
        const result = await fetchFunction(currentTeam.id);
        setData(result);
      } catch (err) {
        setError(err as Error);
      } finally {
        setLoading(false);
      }
    };

    loadData();
  }, [currentTeam, ...dependencies]);

  return { data, loading, error, refetch: () => loadData() };
};

// ä½¿ç”¨ä¾‹
const GameList = () => {
  const { data: games, loading } = useTeamData(
    (teamId) => gameService.getTeamGames(teamId)
  );

  if (loading) return <Spinner />;
  
  return (
    <div>
      {games?.map(game => <GameCard key={game.id} game={game} />)}
    </div>
  );
};
```

## âœ… å—ã‘å…¥ã‚Œæ¡ä»¶

- [ ] ãƒãƒ¼ãƒ é¸æŠUIãŒè¡¨ç¤ºã•ã‚Œã‚‹
- [ ] ãƒãƒ¼ãƒ åˆ‡ã‚Šæ›¿ãˆãŒå³åº§ã«åæ˜ ã•ã‚Œã‚‹
- [ ] é¸æŠã—ãŸãƒãƒ¼ãƒ ãŒä¿æŒã•ã‚Œã‚‹
- [ ] ãƒ‡ãƒ¼ã‚¿ãŒé©åˆ‡ã«ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ã•ã‚Œã‚‹

## ğŸ”§ æŠ€è¡“è¦ä»¶

- React Context
- LocalStorage
- ãƒ‡ãƒ¼ã‚¿ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°

## â±ï¸ è¦‹ç©ã‚‚ã‚Šæ™‚é–“
4æ™‚é–“

## ğŸ”— ä¾å­˜é–¢ä¿‚
- P3-001: ãƒãƒ¼ãƒ CRUDæ©Ÿèƒ½å®Ÿè£…

## ğŸ§ª ãƒ†ã‚¹ãƒˆæ–¹é‡

```typescript
describe('Team Switching', () => {
  it('should persist team selection', () => {
    const { result } = renderHook(() => useTeam());
    
    act(() => {
      result.current.switchTeam(2);
    });

    expect(localStorage.getItem('currentTeamId')).toBe('2');
    expect(result.current.currentTeam?.id).toBe(2);
  });
});
```

## ğŸ“Œ æ³¨æ„äº‹é …

- ãƒãƒ¼ãƒ åˆ‡ã‚Šæ›¿ãˆæ™‚ã®ãƒ‡ãƒ¼ã‚¿æ•´åˆæ€§
- ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã®è€ƒæ…®
- UIã®å³åº§ãªåæ˜ 

## ğŸ·ï¸ ãƒ©ãƒ™ãƒ«
`team`, `ui`, `context`, `phase3`

## ğŸ“… ä½œæˆæ—¥
2025-09-08